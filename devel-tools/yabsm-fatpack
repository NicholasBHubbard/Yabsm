#!/usr/bin/env bash

# Use App::FatPacker to pack all of yabsm including its dependencies into one
# script. The end user will be given only the fatpacked script.

set -e

# Lets work from the yabsm root directory.
YABSM_ROOT=$(realpath "$(dirname "$(readlink -f "$0")")"/..)
cd "$YABSM_ROOT" || (echo "error: could not cd to dir '$YABSM_ROOT'" >&2 && exit 1)

FATPACK_EXECUTABLE="$YABSM_ROOT"/local/bin/fatpack

FATPACK_COMMAND="plx --perl $FATPACK_EXECUTABLE pack $YABSM_ROOT/src/yabsm.pl > $YABSM_ROOT/export/yabsm.fatpack.pl"
echo "$SCRIPT: executing: $FATPACK_COMMAND"
eval "$FATPACK_COMMAND"
