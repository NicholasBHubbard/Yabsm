#!/usr/bin/env perl

#  Author:  Nicholas Hubbard
#  WWW:     https://github.com/NicholasBHubbard/yabsm
#  License: MIT

#  Interface for using cpanminus with plx.

use strict;
use warnings;
use v5.16.3;

use Cwd qw/abs_path/;
use File::Basename qw/basename dirname/;

my $script = basename(__FILE__);
my $yabsm_root = dirname(abs_path(__FILE__ . '/..'));

my $plx = `sh -c 'command -v plx'`
       || ( -x "$yabsm_root/local/bin/plx" && "$yabsm_root/local/bin/plx" )
       || die "$script: error: could not find a plx executable";

chomp $plx;

chdir $yabsm_root;

my $cpanm_cmd = "PERL_CPANM_HOME=$yabsm_root $plx --cpanm -L local -v @ARGV";
say "$script: executing: $cpanm_cmd";
system($cpanm_cmd);

say 'all good';
