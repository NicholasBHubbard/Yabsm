#!/usr/bin/env perl

#  Author: Nicholas Hubbard
#  Email:  nicholashubbard@posteo.net
#  WWW:    https://github.com/NicholasBHubbard/yabsm
#
#  Installation script for yabsm and yabsmd. Installation of yabsm is as
#  simple as figuring out where to put the files in yabsms 'export' directory.

use strict;
use warnings;
use v5.16.3;

use File::Copy 'cp';
use File::Basename qw/basename dirname/;
use Cwd 'abs_path';

use Getopt::Long qw/:config bundling no_ignore_case no_auto_abbrev/;

my $script = basename(__FILE__);
# We assume this script is in the root of the yabsm dir.
my $yabsm_root = dirname(abs_path(__FILE__));

my $usage = <<END_USAGE;
Usage: $script [-y dir | -d dir]

Arguments:
  -h or --help     Print help (this message) and exit
  -q               Suppress output
  -y <dir>         Install yabsm to <dir> - defaults to /usr/local/bin
  -d <dir>         Install yabsmd to <dir> - defaults to /usr/local/sbin
END_USAGE

my $help;
my $quiet;
my $yabsm_install_dir  = '/usr/local/bin/';
my $yabsmd_install_dir = '/usr/local/sbin/';

GetOptions( 'y=s'    => \$yabsm_install_dir
          , 'd=s'    => \$yabsmd_install_dir
          , 'q'      => \$quiet
          , 'help|h' => \$help
          ) or die $usage;

print $usage and exit 0 if $help;

my $yabsmd_conf = '/etc/yabsmd.conf.example';
my $yabsm       = "$yabsm_install_dir/yabsm";
my $yabsmd      = "$yabsm_install_dir/yabsmd";

my $export_dir  = "$yabsm_root/export";

cp "$export_dir/yabsmd.conf.example", $yabsmd_conf or die "$script: error: could not install $yabsmd_conf\n";
cp "$export_dir/yabsm.fatpack.pl",    $yabsm       or die "$script: error: could not install $yabsm\n";
cp "$export_dir/yabsmd.fatpack.pl",   $yabsmd      or die "$script: error: could not install $yabsmd\n";

unless ($quiet) {
    say "$script: installed $yabsmd_conf";
    say "$script: installed $yabsm";
    say "$script: installed $yabsmd";
    say "\nall good"
}
